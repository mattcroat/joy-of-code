---
title: Avoid Flashing Iframe Inside Your Code Sandbox
description: Learn how online code editors are able to update the contents of the iframe without causing flashing
published: '2021-9-29'
category: 'javascript'
image: '/images/avoid-flashing-iframe/og-image.webp'
---

# Avoid Flashing Iframe Inside Your Code Sandbox

In a previous post [Create a Coding Sandbox](https://joyofcode.xyz/create-a-coding-sandbox) we created a simple **code sandbox** from scratch using plain **TypeScript** and it works great but then I noticed something interesting.

I was used to the constant iframe flashing on each update when using [Codepen](https://codepen.io/) but when I was playing around in the [Svelte REPL](https://svelte.dev/repl/hello-world) I noticed it doesn't do that ‚Äî in fact it updates **instantly** without the iframe flashing.

At first I thought how could this be? Does it use some clever framework **DOM** (Document Object Model) updates behind the scenes? I was imagining this magical solution when the answer is simpler than you might think.

## The Flashing Iframe

First let me show you a demonstration of the offending code.

```html:index.html
<textarea spellcheck="false"></textarea>
<iframe></iframe>
```

```js:app.js
const editorElement = document.querySelector('textarea');
const iframeElement = document.querySelector('iframe');

editorElement.addEventListener('input', (event) => {
  // get current editor value
  const html = event.target.value;

  // update iframe
  iframeElement.srcdoc = `
    <html>
      <body>
        ${html}
      </body>
    </html>
  `
})
```

<video autoplay="true" loop muted controls>
  <source
    src="/images/avoid-flashing-iframe/iframe-flashing.mp4"
    type="video/mp4"
  />
</video>

This is just takes a `<textarea>` input and updates the `srcdoc` attribute of the `<iframe>` creating a minimal possible code sandbox.

In my example I have some basic styles that I haven't included here to keep things simple.

## The Solution

The **solution** to the flashing iframe is to not update the `srcdoc` each time a change happens but send a **message** from the parent to perform **DOM** manipulation inside the `<iframe>` which causes no refresh.

We can do this using the [window.postMessage()](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) method from the parent `window` and listen for **messages** inside the `<iframe>` using the [message event listener](https://developer.mozilla.org/en-US/docs/Web/API/Window/message_event).

```js:app.js
const editorElement = document.querySelector('textarea');
const iframeElement = document.querySelector('iframe');

// set `srcdoc` once and listen for any message
iframeElement.srcdoc = `
  <html>
    <head>
    <script type="module">
      window.addEventListener('message', (event) => {
        const { type, value } = event.data;

        if (type === 'html') {
          document.body.innerHTML = value;
        }
      })
    </script>
    </head>
    <body>
    </body>
  </html>
`

editorElement.addEventListener('input', (event) => {
  // get current editor value
  const html = event.target.value;

  // imagine you had different html, css and javascript files
  const html = { type: 'html', value };

  iframeElement.contentWindow.postMessage(html, '*');
})
```

<video autoplay="true" loop muted controls>
  <source
    src="/images/avoid-flashing-iframe/iframe-without-flashing.mp4"
    type="video/mp4"
  />
</video>

You can determine what to do based on the `type`. For example you can inject **CSS**, or insert a `<script>` tag to execute **JavaScript** code.

The second parameter of `postMessage` is the **target origin**. In this case we're saying **\*** which means **anything**.

## Conclusion

This might seem insignificant but it provides a magical user experience. Stay curious and question how things work.

Thanks for reading! üèÑ‚Äç‚ôÄÔ∏è
